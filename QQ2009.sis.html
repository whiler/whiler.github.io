<!DOCTYPE html>
<html lang="cmn">
<head>
        <meta charset="utf-8" />
        <title>手机QQ2009聊天记录分析及提取</title>
        <link rel="stylesheet" href="https://whiler.github.io/theme/css/main.css" />
        <link rel="icon" href="https://whiler.github.io/theme/images/favicon.svg"/>
        <link href="https://whiler.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="轨迹/trace Atom Feed" />
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-74531835-1"></script>
        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body>
    <header><h1><a href="https://whiler.github.io/" title="I leave no trace of wings in the air, but I am glad I have had my flight.">轨迹/trace</a></h1></header>
	<hr/>
<article class="main">
    <header><h2 class="center">手机QQ2009聊天记录分析及提取</h2></header>
	<hr/>
<div class="meta">
	发布于/Published: <a href="/archives.html" title="归档/Archives"><time datetime="2009-10-14T00:00:00+08:00">Wed 14 October 2009</time></a>
</div>    <div class="content"><p>这是我的最早一个像程序的程序。</p>
<blockquote>
<p>十月十三号用上手机QQ2009了，一看，果然更花哨了。但以前写的手机QQ聊天记录提取程序用不上了，莫办法，重新分析。</p>
<p>一手机QQ2009聊天记录文件的存放位置</p>
<p>C:/System/data/Tencent/QQ/自己的QQ号码/好友的QQ号码/msg.info</p>
<p>假如手机QQ装在E盘的把，上面盘符改成E就是了。</p>
<p>二手机QQ2009聊天记录文件的字符编码</p>
<p>手机QQ2009聊天记录文件的字符编码还是和手机QQ2008聊天记录文件的字符编码一样的，用的是UTF-16</p>
<p>三手机QQ2009聊天记录文件结构分析</p>
<p>和手机QQ2008聊天记录文件不一样了！</p>
<p>注：我用的是十六进制分析</p>
<p>消息分位发送消息和接收消息</p>
<p>发送消息</p>
<p>发送消息的十六进制表示以a8 ??(??表示一个十六进制数)标记开始并以它标记结束，接着用四个字节记录这条消息的序列，接着空出六个字节来，下一个字节是十六进制的80，说明消息是发送消息，从此以后位消息内容，直到，消息结束标记a8 ??。</p>
<p>例如：</p>
<p>发送消息 “不”字的消息的十六进制</p>
<p>a8 024a d5 0a d3 00 00 00 00 00 00800d 4ea8 02</p>
<p>注： a8 02 中的 02 是随机的，但前后统一。</p>
<p>接收消息</p>
<p>发送消息的十六进制表示以a8 ??标记开始并以它标记结束，接着用四个字节记录这条消息的序列，接着空出六个字节来，下一个字节是十六进制的00，说明消息是发送消息，从此以后位消息内容，直到，消息结束标记a8 ??。</p>
<p>接收消息 “不”字的消息的十六进制</p>
<p>a8 064a d5 0a bf 00 00 00 00 00 00000d 4ea8 06</p>
<p>注： a8 06 中的 06 是随机的，但前后统一。</p>
<p>四 提取手机QQ2009的聊天记录</p>
<p>经过分析，提取就简单了。</p>
<p>需要提取手机QQ2009聊天记录的友友可以把你的msg.info文件发给俺：</p>
<p>最后，这是为了师太写的，嘿嘿。</p>
<p>分析有误的地方请指出，一起分享；代码写得差了，请多指教。</p>
<p>补：上网一看，汗，要把手机QQ2008以前聊天记录的导入到手机QQ2009里面来还没人做，俺继续研究，应该不难，手机QQ2008的聊天记录俺有分析及提取的程序，嘿嘿。</p>
</blockquote>
<p>下面是提取手机QQ2009聊天记录的Python语言代码：</p>
<div class="highlight"><pre><span></span><span class="c1"># Encoding:UTF-8</span>
<span class="c1"># FileName:PickupMobileQQ2009Message</span>
<span class="c1"># Date:2009_10_14</span>

<span class="c1"># from DMQCR.convert import OtoA</span>
<span class="c1"># I write this module for convert the expression code to char code</span>

<span class="s s-Atom">def</span> <span class="nf">pickup</span><span class="p">(</span><span class="s s-Atom">path</span><span class="p">)</span><span class="s s-Atom">:</span>
    <span class="s s-Atom">fp</span> <span class="o">=</span> <span class="nf">file</span><span class="p">(</span><span class="s s-Atom">path</span><span class="p">)</span>
    <span class="s s-Atom">wfp</span> <span class="o">=</span> <span class="nf">file</span><span class="p">(</span><span class="s s-Atom">path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;txt&quot;</span><span class="p">),</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span>
    <span class="s s-Atom">while</span> <span class="nv">True</span> <span class="s s-Atom">:</span>
        <span class="s s-Atom">mark</span> <span class="o">=</span> <span class="s s-Atom">fp</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">one</span> <span class="s s-Atom">message</span><span class="err">&#39;</span><span class="s s-Atom">s</span> <span class="s s-Atom">start</span> <span class="s s-Atom">and</span> <span class="s s-Atom">end</span> <span class="s s-Atom">mark</span>
        <span class="s s-Atom">if</span> <span class="o">not</span> <span class="nn">mark</span><span class="p">:</span>
            <span class="s s-Atom">break</span>
        <span class="s s-Atom">fp</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">the</span> <span class="s s-Atom">ten</span> <span class="s s-Atom">chars</span> <span class="s s-Atom">are</span> <span class="s s-Atom">useless</span> <span class="s s-Atom">for</span> <span class="s s-Atom">pickup</span><span class="p">.</span>
        <span class="s s-Atom">flag</span> <span class="o">=</span> <span class="s s-Atom">fp</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">send</span> <span class="s s-Atom">flag</span> <span class="mi">80</span> <span class="s s-Atom">end</span><span class="p">,</span><span class="mi">00</span> <span class="s s-Atom">receive</span>
        <span class="s s-Atom">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="s s-Atom">while</span> <span class="nv">True</span><span class="s s-Atom">:</span>
            <span class="s s-Atom">t</span> <span class="o">=</span> <span class="s s-Atom">fp</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="s s-Atom">if</span> <span class="s s-Atom">mark</span> <span class="p">!</span><span class="o">=</span> <span class="nn">t</span><span class="p">:</span>
                <span class="s s-Atom">message</span> <span class="s s-Atom">+=</span> <span class="s s-Atom">t</span>
            <span class="nn">else</span><span class="p">:</span>
                <span class="s s-Atom">message</span> <span class="o">=</span> <span class="s s-Atom">message</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="s2">&quot;\x20\x00&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="s s-Atom">message</span> <span class="o">=</span> <span class="s s-Atom">message</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="s2">&quot;UTF-16&quot;</span><span class="p">)</span>  <span class="s s-Atom">#</span> <span class="s s-Atom">if</span> <span class="s s-Atom">you</span> <span class="s s-Atom">have</span> <span class="s s-Atom">some</span> <span class="s s-Atom">function</span> <span class="s s-Atom">to</span> <span class="s s-Atom">convert</span> <span class="s s-Atom">the</span> <span class="s s-Atom">expression</span> <span class="s s-Atom">code</span> <span class="s s-Atom">to</span> <span class="s s-Atom">char</span> <span class="s s-Atom">code</span><span class="p">,</span><span class="s s-Atom">plaese</span> <span class="s s-Atom">change</span> <span class="s s-Atom">this</span> <span class="s s-Atom">line</span> <span class="s2">&quot;message=functionname(massage).decode(&quot;</span><span class="nv">UTF</span><span class="o">-</span><span class="mi">16</span><span class="s2">&quot;)&quot;</span>
            <span class="s s-Atom">if</span> <span class="err">&quot;</span><span class="s s-Atom">\x80</span><span class="s2">&quot; == flag:</span>
<span class="s2">                wfp.write(&quot;</span><span class="nv">SEND</span><span class="s s-Atom">:</span><span class="s2">&quot; + message.encode(&quot;</span><span class="nv">UTF</span><span class="o">-</span><span class="mi">8</span><span class="s2">&quot;) + &quot;</span><span class="s s-Atom">\r\n</span><span class="s2">&quot;)</span>
<span class="s2">                print &quot;</span><span class="nv">SEND</span><span class="s s-Atom">:</span> <span class="s2">&quot;, message</span>
<span class="s2">            else:</span>
<span class="s2">                wfp.write(&quot;</span><span class="nv">RECEIVE</span><span class="s s-Atom">:</span> <span class="s2">&quot; + message.encode(&quot;</span><span class="nv">UTF</span><span class="o">-</span><span class="mi">8</span><span class="s2">&quot;) + &quot;</span><span class="s s-Atom">\r\n</span><span class="s2">&quot;)</span>
<span class="s2">                print &quot;</span><span class="nv">RECEIVE</span><span class="s s-Atom">:</span><span class="s2">&quot;, message</span>
<span class="s2">            pass  # you can do more</span>
<span class="s2">            del message</span>
<span class="s2">            break</span>
<span class="s2">    fp.close()</span>
<span class="s2">    wfp.close()</span>
<span class="s2">    del mark, flag, wfp, fp</span>

<span class="s2">if __name__ == &quot;</span><span class="k">__</span><span class="s s-Atom">main__</span><span class="s2">&quot;:</span>
<span class="s2">    print &quot;</span><span class="nv">Running</span><span class="s s-Atom">--------</span><span class="s2">&quot;</span>
<span class="s2">    pickup(&quot;</span><span class="nn">e</span><span class="p">:</span><span class="s s-Atom">\\msg</span><span class="p">.</span><span class="s s-Atom">info</span><span class="s2">&quot;)</span>
<span class="s2">    print &quot;</span><span class="p">:-</span><span class="err">&quot;</span> <span class="o">*</span> <span class="mi">20</span>
</pre></div></div>
    <aside class="comments">
		<h3>评论/Comments</h3>
		<div id="disqus_thread"></div>
		<script>
		    var disqus_config = function () {
				this.page.url = location.protocol + '//' + location.host + location.pathname;
		    	this.page.identifier = 'a8673dce-3f87-4c0d-a72a-5ba40edb5437';
		    };
			(function() {
				var d = document, s = d.createElement('script');
				s.src = 'https://traced.disqus.com/embed.js';
				s.setAttribute('data-timestamp', +new Date());
				(d.head || d.body).appendChild(s);
			})();
		</script>
		<noscript>请启用 JavaScript 脚本以查看评论/Please enable JavaScript to view the comments.</noscript>
    </aside>
</article>
	<hr/>
    <footer class="center">始于 2016 | SINCE 2016</footer>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){ dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'UA-74531835-1');
	</script>
</body>
</html>