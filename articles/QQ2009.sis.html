<!doctype html>
<html lang="cmn">
    <head>
        <title>手机QQ2009聊天记录分析及提取</title>
        <meta charset="utf-8"/>
        <link href="/static/style/main.css" rel="stylesheet"/>
        <link href="/static/image/favicon.svg" rel="icon"/>
        <link href="/feed.xml" type="application/rss+xml" rel="alternate"/>
    </head>
    <body>
        <article>
<h2>手机QQ2009聊天记录分析及提取</h2>
<p>这是我的最早一个像程序的程序。</p>
<blockquote>
<p>十月十三号用上手机QQ2009了，一看，果然更花哨了。但以前写的手机QQ聊天记录提取程序用不上了，莫办法，重新分析。</p>
<p>一手机QQ2009聊天记录文件的存放位置</p>
<p>C:/System/data/Tencent/QQ/自己的QQ号码/好友的QQ号码/msg.info</p>
<p>假如手机QQ装在E盘的把，上面盘符改成E就是了。</p>
<p>二手机QQ2009聊天记录文件的字符编码</p>
<p>手机QQ2009聊天记录文件的字符编码还是和手机QQ2008聊天记录文件的字符编码一样的，用的是UTF-16</p>
<p>三手机QQ2009聊天记录文件结构分析</p>
<p>和手机QQ2008聊天记录文件不一样了！</p>
<p>注：我用的是十六进制分析</p>
<p>消息分位发送消息和接收消息</p>
<p>发送消息</p>
<p>发送消息的十六进制表示以a8 ??(??表示一个十六进制数)标记开始并以它标记结束，接着用四个字节记录这条消息的序列，接着空出六个字节来，下一个字节是十六进制的80，说明消息是发送消息，从此以后位消息内容，直到，消息结束标记a8 ??。</p>
<p>例如：</p>
<p>发送消息 “不”字的消息的十六进制</p>
<p>a8 024a d5 0a d3 00 00 00 00 00 00800d 4ea8 02</p>
<p>注： a8 02 中的 02 是随机的，但前后统一。</p>
<p>接收消息</p>
<p>发送消息的十六进制表示以a8 ??标记开始并以它标记结束，接着用四个字节记录这条消息的序列，接着空出六个字节来，下一个字节是十六进制的00，说明消息是发送消息，从此以后位消息内容，直到，消息结束标记a8 ??。</p>
<p>接收消息 “不”字的消息的十六进制</p>
<p>a8 064a d5 0a bf 00 00 00 00 00 00000d 4ea8 06</p>
<p>注： a8 06 中的 06 是随机的，但前后统一。</p>
<p>四 提取手机QQ2009的聊天记录</p>
<p>经过分析，提取就简单了。</p>
<p>需要提取手机QQ2009聊天记录的友友可以把你的msg.info文件发给俺：</p>
<p>最后，这是为了师太写的，嘿嘿。</p>
<p>分析有误的地方请指出，一起分享；代码写得差了，请多指教。</p>
<p>补：上网一看，汗，要把手机QQ2008以前聊天记录的导入到手机QQ2009里面来还没人做，俺继续研究，应该不难，手机QQ2008的聊天记录俺有分析及提取的程序，嘿嘿。</p>
</blockquote>
<p>下面是提取手机QQ2009聊天记录的Python语言代码：</p>
<pre><code># Encoding:UTF-8
# FileName:PickupMobileQQ2009Message
# Date:2009_10_14

# from DMQCR.convert import OtoA
# I write this module for convert the expression code to char code

def pickup(path):
    fp = file(path)
    wfp = file(path.replace(&quot;info&quot;, &quot;txt&quot;), &quot;a&quot;)
    while True :
        mark = fp.read(2)  # one message's start and end mark
        if not mark:
            break
        fp.read(10)  # the ten chars are useless for pickup.
        flag = fp.read(1)  # send flag 80 end,00 receive
        message = &quot;&quot;
        while True:
            t = fp.read(2)
            if mark != t:
                message += t
            else:
                message = message.replace(&quot;\x20\x00&quot;, &quot;&quot;)
                message = message.decode(&quot;UTF-16&quot;)  # if you have some function to convert the expression code to char code,plaese change this line &quot;message=functionname(massage).decode(&quot;UTF-16&quot;)&quot;
            if &quot;\x80&quot; == flag:
                wfp.write(&quot;SEND:&quot; + message.encode(&quot;UTF-8&quot;) + &quot;\r\n&quot;)
                print &quot;SEND: &quot;, message
            else:
                wfp.write(&quot;RECEIVE: &quot; + message.encode(&quot;UTF-8&quot;) + &quot;\r\n&quot;)
                print &quot;RECEIVE:&quot;, message
            pass  # you can do more
            del message
            break
    fp.close()
    wfp.close()
    del mark, flag, wfp, fp

if __name__ == &quot;__main__&quot;:
    print &quot;Running--------&quot;
    pickup(&quot;e:\\msg.info&quot;)
    print &quot;:-&quot; * 20
</code></pre>
<p><time>2009-10-14</time></p>
        </article>
        <aside id="disqus_thread"></aside>
        <footer>SINCE 2016</footer>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            
            ga('create', 'UA-74531835-1', 'auto');
            ga('send', 'pageview');
        </script>
        <script>
            var disqus_config = function () {
                this.page.url = location.protocol + '//' + location.host + location.pathname;
                this.page.identifier = 'a8673dce-3f87-4c0d-a72a-5ba40edb5437';
            };
            (function() {
                var d = document, s = d.createElement('script');
                s.src = '//traced.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    </body>
</html>